<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "6fb74f952ab79ed4b4a33fda5fa04ecb",
  "translation_date": "2025-07-31T01:18:31+00:00",
  "source_file": "03-GettingStarted/07-aitk/README.md",
  "language_code": "fa"
}
-->
# استفاده از یک سرور با افزونه AI Toolkit در Visual Studio Code

وقتی در حال ساخت یک عامل هوش مصنوعی هستید، موضوع فقط تولید پاسخ‌های هوشمند نیست؛ بلکه باید به عامل خود توانایی انجام اقدامات را نیز بدهید. اینجاست که پروتکل Model Context Protocol (MCP) وارد عمل می‌شود. MCP به عوامل اجازه می‌دهد تا به ابزارها و خدمات خارجی به روشی یکپارچه دسترسی پیدا کنند. می‌توانید آن را مانند وصل کردن عامل خود به یک جعبه ابزار تصور کنید که واقعاً می‌تواند از آن استفاده کند.

فرض کنید یک عامل را به سرور MCP ماشین‌حساب خود متصل می‌کنید. ناگهان، عامل شما می‌تواند عملیات ریاضی را فقط با دریافت یک درخواست مانند «47 ضرب در 89 چند می‌شود؟» انجام دهد—بدون نیاز به کدنویسی دستی یا ساخت API‌های سفارشی.

## مرور کلی

این درس نحوه اتصال یک سرور MCP ماشین‌حساب به یک عامل با استفاده از افزونه [AI Toolkit](https://aka.ms/AIToolkit) در Visual Studio Code را پوشش می‌دهد، که به عامل شما امکان انجام عملیات ریاضی مانند جمع، تفریق، ضرب و تقسیم از طریق زبان طبیعی را می‌دهد.

AI Toolkit یک افزونه قدرتمند برای Visual Studio Code است که توسعه عامل‌ها را ساده می‌کند. مهندسان هوش مصنوعی می‌توانند به راحتی برنامه‌های هوش مصنوعی بسازند و مدل‌های تولیدی هوش مصنوعی را به صورت محلی یا در فضای ابری توسعه و آزمایش کنند. این افزونه از اکثر مدل‌های تولیدی اصلی موجود پشتیبانی می‌کند.

*توجه*: AI Toolkit در حال حاضر از Python و TypeScript پشتیبانی می‌کند.

## اهداف یادگیری

در پایان این درس، شما قادر خواهید بود:

- استفاده از یک سرور MCP از طریق AI Toolkit.
- پیکربندی تنظیمات عامل برای کشف و استفاده از ابزارهای ارائه‌شده توسط سرور MCP.
- استفاده از ابزارهای MCP از طریق زبان طبیعی.

## رویکرد

در اینجا نحوه پیشبرد کار در سطح بالا آمده است:

- ایجاد یک عامل و تعریف درخواست سیستمی آن.
- ایجاد یک سرور MCP با ابزارهای ماشین‌حساب.
- اتصال Agent Builder به سرور MCP.
- آزمایش فراخوانی ابزار عامل از طریق زبان طبیعی.

عالی است، حالا که جریان کار را درک کردیم، بیایید یک عامل هوش مصنوعی را پیکربندی کنیم تا از ابزارهای خارجی از طریق MCP استفاده کند و قابلیت‌های آن را افزایش دهیم!

## پیش‌نیازها

- [Visual Studio Code](https://code.visualstudio.com/)
- [AI Toolkit برای Visual Studio Code](https://aka.ms/AIToolkit)

## تمرین: استفاده از یک سرور

> [!WARNING]
> توجه برای کاربران macOS. ما در حال بررسی مشکلی هستیم که بر نصب وابستگی‌ها در macOS تأثیر می‌گذارد. در نتیجه، کاربران macOS در حال حاضر نمی‌توانند این آموزش را تکمیل کنند. به محض رفع مشکل، دستورالعمل‌ها به‌روزرسانی خواهند شد. از صبر و درک شما سپاسگزاریم!

در این تمرین، شما یک عامل هوش مصنوعی را با ابزارهای یک سرور MCP در داخل Visual Studio Code با استفاده از AI Toolkit می‌سازید، اجرا می‌کنید و بهبود می‌بخشید.

### -0- مرحله پیش‌نیاز: افزودن مدل OpenAI GPT-4o به My Models

این تمرین از مدل **GPT-4o** استفاده می‌کند. مدل باید قبل از ایجاد عامل به **My Models** اضافه شود.

![تصویری از رابط انتخاب مدل در افزونه AI Toolkit در Visual Studio Code. عنوان "مدل مناسب برای راه‌حل هوش مصنوعی خود را پیدا کنید" با زیرعنوانی که کاربران را به کشف، آزمایش و استقرار مدل‌های هوش مصنوعی تشویق می‌کند. در زیر، در بخش "مدل‌های محبوب"، شش کارت مدل نمایش داده شده است: DeepSeek-R1 (میزبانی‌شده در GitHub)، OpenAI GPT-4o، OpenAI GPT-4.1، OpenAI o1، Phi 4 Mini (CPU - کوچک، سریع)، و DeepSeek-R1 (میزبانی‌شده در Ollama). هر کارت شامل گزینه‌هایی برای "افزودن" مدل یا "آزمایش در Playground" است.](../../../../translated_images/aitk-model-catalog.2acd38953bb9c119aa629fe74ef34cc56e4eed35e7f5acba7cd0a59e614ab335.fa.png)

1. افزونه **AI Toolkit** را از **Activity Bar** باز کنید.
1. در بخش **Catalog**، **Models** را انتخاب کنید تا **Model Catalog** باز شود. انتخاب **Models**، **Model Catalog** را در یک تب جدید باز می‌کند.
1. در نوار جستجوی **Model Catalog**، عبارت **OpenAI GPT-4o** را وارد کنید.
1. روی **+ Add** کلیک کنید تا مدل به لیست **My Models** شما اضافه شود. اطمینان حاصل کنید که مدلی که انتخاب کرده‌اید **Hosted by GitHub** باشد.
1. در **Activity Bar**، تأیید کنید که مدل **OpenAI GPT-4o** در لیست ظاهر شده است.

### -1- ایجاد یک عامل

**Agent (Prompt) Builder** به شما امکان می‌دهد عوامل هوش مصنوعی خود را ایجاد و سفارشی کنید. در این بخش، شما یک عامل جدید ایجاد کرده و یک مدل را برای قدرت‌بخشیدن به مکالمه اختصاص می‌دهید.

![تصویری از رابط "Calculator Agent" در افزونه AI Toolkit برای Visual Studio Code. در پنل سمت چپ، مدل انتخاب‌شده "OpenAI GPT-4o (via GitHub)" است. یک درخواست سیستمی نوشته شده: "شما یک استاد دانشگاه هستید که ریاضیات تدریس می‌کنید"، و درخواست کاربر می‌گوید: "معادله فوریه را به زبان ساده توضیح دهید." گزینه‌های اضافی شامل دکمه‌هایی برای افزودن ابزارها، فعال‌کردن سرور MCP و انتخاب خروجی ساختاریافته است. یک دکمه آبی "Run" در پایین قرار دارد. در پنل سمت راست، تحت "شروع با مثال‌ها"، سه عامل نمونه لیست شده‌اند: توسعه‌دهنده وب (با سرور MCP، ساده‌کننده کلاس دوم، و تعبیرکننده رویا، هرکدام با توضیحات مختصر از عملکردشان).](../../../../translated_images/aitk-agent-builder.901e3a2960c3e4774b29a23024ff5bec2d4232f57fae2a418b2aaae80f81c05f.fa.png)

1. افزونه **AI Toolkit** را از **Activity Bar** باز کنید.
1. در بخش **Tools**، **Agent (Prompt) Builder** را انتخاب کنید. انتخاب **Agent (Prompt) Builder**، آن را در یک تب جدید باز می‌کند.
1. روی دکمه **+ New Agent** کلیک کنید. افزونه یک ویزارد تنظیمات را از طریق **Command Palette** باز می‌کند.
1. نام **Calculator Agent** را وارد کرده و **Enter** را فشار دهید.
1. در **Agent (Prompt) Builder**، برای فیلد **Model**، مدل **OpenAI GPT-4o (via GitHub)** را انتخاب کنید.

### -2- ایجاد یک درخواست سیستمی برای عامل

با ایجاد ساختار عامل، اکنون زمان تعریف شخصیت و هدف آن است. در این بخش، از ویژگی **Generate system prompt** برای توصیف رفتار موردنظر عامل استفاده می‌کنید—در این مورد، یک عامل ماشین‌حساب—و مدل درخواست سیستمی را برای شما می‌نویسد.

![تصویری از رابط "Calculator Agent" در AI Toolkit برای Visual Studio Code با یک پنجره باز با عنوان "Generate a prompt." پنجره توضیح می‌دهد که یک قالب درخواست می‌تواند با اشتراک‌گذاری جزئیات اساسی تولید شود و شامل یک جعبه متن با درخواست سیستمی نمونه: "شما یک دستیار ریاضی مفید و کارآمد هستید. وقتی مسئله‌ای شامل حساب‌های پایه به شما داده می‌شود، با نتیجه صحیح پاسخ می‌دهید." در زیر جعبه متن دکمه‌های "بستن" و "تولید" قرار دارند. در پس‌زمینه، بخشی از تنظیمات عامل قابل مشاهده است، از جمله مدل انتخاب‌شده "OpenAI GPT-4o (via GitHub)" و فیلدهای درخواست سیستمی و کاربر.](../../../../translated_images/aitk-generate-prompt.ba9e69d3d2bbe2a26444d0c78775540b14196061eee32c2054e9ee68c4f51f3a.fa.png)

1. برای بخش **Prompts**، روی دکمه **Generate system prompt** کلیک کنید. این دکمه پنجره‌ای را باز می‌کند که از هوش مصنوعی برای تولید درخواست سیستمی برای عامل استفاده می‌کند.
1. در پنجره **Generate a prompt**، متن زیر را وارد کنید: `شما یک دستیار ریاضی مفید و کارآمد هستید. وقتی مسئله‌ای شامل حساب‌های پایه به شما داده می‌شود، با نتیجه صحیح پاسخ می‌دهید.`
1. روی دکمه **Generate** کلیک کنید. یک اعلان در گوشه پایین سمت راست ظاهر می‌شود که تأیید می‌کند درخواست سیستمی در حال تولید است. پس از تکمیل تولید، درخواست در فیلد **System prompt** در **Agent (Prompt) Builder** ظاهر می‌شود.
1. درخواست سیستمی را بررسی کرده و در صورت لزوم تغییر دهید.

### -3- ایجاد یک سرور MCP

اکنون که درخواست سیستمی عامل خود را تعریف کرده‌اید—که رفتار و پاسخ‌های آن را هدایت می‌کند—زمان آن رسیده که عامل را به قابلیت‌های عملی مجهز کنید. در این بخش، یک سرور MCP ماشین‌حساب با ابزارهایی برای انجام محاسبات جمع، تفریق، ضرب و تقسیم ایجاد می‌کنید. این سرور به عامل شما امکان می‌دهد عملیات ریاضی را در زمان واقعی در پاسخ به درخواست‌های زبان طبیعی انجام دهد.

!["تصویری از بخش پایین رابط Calculator Agent در افزونه AI Toolkit برای Visual Studio Code. منوهای قابل گسترش برای “Tools” و “Structure output” نشان داده شده‌اند، همراه با یک منوی کشویی با برچسب “Choose output format” که روی “text” تنظیم شده است. در سمت راست، یک دکمه با برچسب “+ MCP Server” برای افزودن یک سرور Model Context Protocol وجود دارد. یک جایگاه آیکون تصویر در بالای بخش Tools نشان داده شده است.](../../../../translated_images/aitk-add-mcp-server.9742cfddfe808353c0caf9cc0a7ed3e80e13abf4d2ebde315c81c3cb02a2a449.fa.png)

AI Toolkit با قالب‌هایی برای سهولت ایجاد سرور MCP خود مجهز شده است. ما از قالب Python برای ایجاد سرور MCP ماشین‌حساب استفاده خواهیم کرد.

*توجه*: AI Toolkit در حال حاضر از Python و TypeScript پشتیبانی می‌کند.

1. در بخش **Tools** از **Agent (Prompt) Builder**، روی دکمه **+ MCP Server** کلیک کنید. افزونه یک ویزارد تنظیمات را از طریق **Command Palette** باز می‌کند.
1. **+ Add Server** را انتخاب کنید.
1. **Create a New MCP Server** را انتخاب کنید.
1. **python-weather** را به عنوان قالب انتخاب کنید.
1. **Default folder** را برای ذخیره قالب سرور MCP انتخاب کنید.
1. نام زیر را برای سرور وارد کنید: **Calculator**
1. یک پنجره جدید Visual Studio Code باز خواهد شد. **Yes, I trust the authors** را انتخاب کنید.
1. با استفاده از ترمینال (**Terminal** > **New Terminal**)، یک محیط مجازی ایجاد کنید: `python -m venv .venv`
1. با استفاده از ترمینال، محیط مجازی را فعال کنید:
    1. ویندوز - `.venv\Scripts\activate`
    1. macOS/Linux - `source venv/bin/activate`
1. با استفاده از ترمینال، وابستگی‌ها را نصب کنید: `pip install -e .[dev]`
1. در نمای **Explorer** از **Activity Bar**، دایرکتوری **src** را گسترش داده و **server.py** را انتخاب کنید تا فایل در ویرایشگر باز شود.
1. کد موجود در فایل **server.py** را با کد زیر جایگزین کرده و ذخیره کنید:

    ```python
    """
    Sample MCP Calculator Server implementation in Python.

    
    This module demonstrates how to create a simple MCP server with calculator tools
    that can perform basic arithmetic operations (add, subtract, multiply, divide).
    """
    
    from mcp.server.fastmcp import FastMCP
    
    server = FastMCP("calculator")
    
    @server.tool()
    def add(a: float, b: float) -> float:
        """Add two numbers together and return the result."""
        return a + b
    
    @server.tool()
    def subtract(a: float, b: float) -> float:
        """Subtract b from a and return the result."""
        return a - b
    
    @server.tool()
    def multiply(a: float, b: float) -> float:
        """Multiply two numbers together and return the result."""
        return a * b
    
    @server.tool()
    def divide(a: float, b: float) -> float:
        """
        Divide a by b and return the result.
        
        Raises:
            ValueError: If b is zero
        """
        if b == 0:
            raise ValueError("Cannot divide by zero")
        return a / b
    ```

### -4- اجرای عامل با سرور MCP ماشین‌حساب

اکنون که عامل شما ابزارهایی دارد، زمان استفاده از آن‌ها فرا رسیده است! در این بخش، درخواست‌هایی را به عامل ارسال می‌کنید تا آزمایش و تأیید کنید که آیا عامل از ابزار مناسب از سرور MCP ماشین‌حساب استفاده می‌کند یا خیر.

![تصویری از رابط Calculator Agent در افزونه AI Toolkit برای Visual Studio Code. در پنل سمت چپ، تحت “Tools”، یک سرور MCP به نام local-server-calculator_server اضافه شده است که چهار ابزار موجود را نشان می‌دهد: add، subtract، multiply، و divide. یک نشانگر نشان می‌دهد که چهار ابزار فعال هستند. در زیر، یک بخش “Structure output” جمع‌شده و یک دکمه آبی “Run” وجود دارد. در پنل سمت راست، تحت “Model Response”، عامل ابزارهای multiply و subtract را با ورودی‌های {"a": 3, "b": 25} و {"a": 75, "b": 20} به ترتیب فراخوانی می‌کند. پاسخ نهایی ابزار به صورت 75.0 نشان داده شده است. یک دکمه “View Code” در پایین ظاهر می‌شود.](../../../../translated_images/aitk-agent-response-with-tools.e7c781869dc8041a25f9903ed4f7e8e0c7e13d7d94f6786a6c51b1e172f56866.fa.png)

شما سرور MCP ماشین‌حساب را روی دستگاه توسعه محلی خود از طریق **Agent Builder** به عنوان کلاینت MCP اجرا خواهید کرد.

1. کلید `F5` را فشار دهید تا اشکال‌زدایی سرور MCP شروع شود. **Agent (Prompt) Builder** در یک تب جدید باز خواهد شد. وضعیت سرور در ترمینال قابل مشاهده است.
1. در فیلد **User prompt** از **Agent (Prompt) Builder**، درخواست زیر را وارد کنید: `من 3 کالا به قیمت هر کدام 25 دلار خریدم و سپس از یک تخفیف 20 دلاری استفاده کردم. چقدر پرداخت کردم؟`
1. روی دکمه **Run** کلیک کنید تا پاسخ عامل تولید شود.
1. خروجی عامل را بررسی کنید. مدل باید نتیجه بگیرد که شما **55 دلار** پرداخت کرده‌اید.
1. در اینجا یک تجزیه و تحلیل از آنچه باید رخ دهد آورده شده است:
    - عامل ابزارهای **multiply** و **subtract** را برای کمک به محاسبه انتخاب می‌کند.
    - مقادیر `a` و `b` مربوطه برای ابزار **multiply** اختصاص داده می‌شوند.
    - مقادیر `a` و `b` مربوطه برای ابزار **subtract** اختصاص داده می‌شوند.
    - پاسخ از هر ابزار در **Tool Response** مربوطه ارائه می‌شود.
    - خروجی نهایی از مدل در **Model Response** نهایی ارائه می‌شود.
1. درخواست‌های اضافی ارسال کنید تا عامل را بیشتر آزمایش کنید. می‌توانید درخواست موجود در فیلد **User prompt** را با کلیک روی فیلد و جایگزینی درخواست موجود تغییر دهید.
1. پس از اتمام آزمایش عامل، می‌توانید سرور را از طریق **ترمینال** با وارد کردن **CTRL/CMD+C** متوقف کنید.

## تکلیف

سعی کنید یک ورودی ابزار اضافی به فایل **server.py** خود اضافه کنید (مثلاً بازگرداندن جذر یک عدد). درخواست‌های اضافی ارسال کنید که نیاز به استفاده عامل از ابزار جدید شما (یا ابزارهای موجود) داشته باشد. حتماً سرور را مجدداً راه‌اندازی کنید تا ابزارهای جدید بارگذاری شوند.

## راه‌حل

[راه‌حل](./solution/README.md)

## نکات کلیدی

نکات کلیدی این فصل به شرح زیر است:

- افزونه AI Toolkit یک کلاینت عالی است که به شما امکان می‌دهد سرورهای MCP و ابزارهای آن‌ها را مصرف کنید.
- می‌توانید ابزارهای جدیدی به سرورهای MCP اضافه کنید و قابلیت‌های عامل را برای برآورده کردن نیازهای در حال تغییر گسترش دهید.
- AI Toolkit شامل قالب‌هایی (مانند قالب‌های سرور MCP Python) برای ساده‌سازی ایجاد ابزارهای سفارشی است.

## منابع اضافی

- [مستندات AI Toolkit](https://aka.ms/AIToolkit/doc)

## مرحله بعدی
- بعدی: [آزمایش و اشکال‌زدایی](../08-testing/README.md)

**سلب مسئولیت**:  
این سند با استفاده از سرویس ترجمه هوش مصنوعی [Co-op Translator](https://github.com/Azure/co-op-translator) ترجمه شده است. در حالی که ما تلاش می‌کنیم دقت را حفظ کنیم، لطفاً توجه داشته باشید که ترجمه‌های خودکار ممکن است شامل خطاها یا نادرستی‌ها باشند. سند اصلی به زبان اصلی آن باید به عنوان منبع معتبر در نظر گرفته شود. برای اطلاعات حیاتی، ترجمه حرفه‌ای انسانی توصیه می‌شود. ما مسئولیتی در قبال سوء تفاهم‌ها یا تفسیرهای نادرست ناشی از استفاده از این ترجمه نداریم.